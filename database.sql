-- MySQL Script generated by MySQL Workbench
-- Sun Mar 24 18:01:11 2024
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS = @@UNIQUE_CHECKS, UNIQUE_CHECKS = 0;
SET @OLD_FOREIGN_KEY_CHECKS = @@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS = 0;
SET @OLD_SQL_MODE = @@SQL_MODE, SQL_MODE =
        'ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema despensa_app
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `despensa_app`;

-- -----------------------------------------------------
-- Schema despensa_app
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `despensa_app` DEFAULT CHARACTER SET utf8;
USE `despensa_app`;

-- -----------------------------------------------------
-- Table `products`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `products`;

CREATE TABLE IF NOT EXISTS `products`
(
    `id`          INT                     NOT NULL AUTO_INCREMENT,
    `name`        VARCHAR(50)             NOT NULL COMMENT 'Nombre del producto',
    `price`       DECIMAL(11, 2) UNSIGNED NOT NULL COMMENT 'Precio del producto',
    `img_url`     VARCHAR(255)            NOT NULL COMMENT 'Url de la imagen del producto.',
    `calories`    DECIMAL(11, 2) UNSIGNED NOT NULL COMMENT 'Calorías del producto',
    `description` VARCHAR(255)            NULL COMMENT 'Descripción del producto, notas, etc.',
    `created_at`  TIMESTAMP               NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at`  TIMESTAMP               NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    COMMENT = 'Productos';


-- -----------------------------------------------------
-- Table `shopping_list`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `shopping_list`;

CREATE TABLE IF NOT EXISTS `shopping_list`
(
    `id`             INT                     NOT NULL AUTO_INCREMENT,
    `name`           VARCHAR(250)            NULL,
    `total_products` INT UNSIGNED            NOT NULL DEFAULT 0 COMMENT 'Número total de productos.',
    `total_calories` DECIMAL(11, 2) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'Total de calorías de todos los productos.',
    `total_price`    DECIMAL(11, 2) UNSIGNED NOT NULL DEFAULT 0 COMMENT 'Precio total de los productos.',
    `created_at`     TIMESTAMP               NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at`     TIMESTAMP               NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    COMMENT = 'Lista de la compra';


-- -----------------------------------------------------
-- Table `unit_types`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `unit_types`;

CREATE TABLE IF NOT EXISTS `unit_types`
(
    `id`         INT         NOT NULL AUTO_INCREMENT,
    `name`       VARCHAR(50) NOT NULL,
    `created_at` TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at` TIMESTAMP   NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB
    COMMENT = 'Tipo de unidad del producto (packs, bricks, botellas, kilos, gramos, latas)';


-- -----------------------------------------------------
-- Table `products_has_shopping_list`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `products_has_shopping_list`;

CREATE TABLE IF NOT EXISTS `products_has_shopping_list`
(
    `product_id`        INT                     NOT NULL,
    `shopping_list_id`  INT                     NOT NULL,
    `unit_type_id`      INT                     NOT NULL,
    `units_per_product` INT UNSIGNED            NOT NULL DEFAULT 1 COMMENT 'Unidades por producto.',
    `total_calories`    DECIMAL(11, 2) UNSIGNED NOT NULL COMMENT 'Total de calorías por unidad.',
    `total_price`       DECIMAL(11, 2) UNSIGNED NOT NULL COMMENT 'Precio total por unidad.',
    `selected`          TINYINT(1)              NOT NULL DEFAULT 0 COMMENT 'Establece si el producto esta seleccionado.',
    PRIMARY KEY (`product_id`, `shopping_list_id`, `unit_type_id`),
    CONSTRAINT `fk_products_has_shopping_list_products`
        FOREIGN KEY (`product_id`)
            REFERENCES `products` (`id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
    CONSTRAINT `fk_products_has_shopping_list_shopping_list`
        FOREIGN KEY (`shopping_list_id`)
            REFERENCES `shopping_list` (`id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION,
    CONSTRAINT `fk_products_has_shopping_list_unit_types`
        FOREIGN KEY (`unit_type_id`)
            REFERENCES `unit_types` (`id`)
            ON DELETE NO ACTION
            ON UPDATE NO ACTION
)
    ENGINE = InnoDB
    COMMENT = 'Relación de productos y lista de la compra.';

CREATE INDEX `fk_products_has_shopping_list_shopping_list_id` ON `products_has_shopping_list` (`shopping_list_id` ASC) VISIBLE;

CREATE INDEX `fk_products_has_shopping_list_products_id` ON `products_has_shopping_list` (`product_id` ASC) VISIBLE;

CREATE INDEX `fk_products_has_shopping_list_unit_types_id` ON `products_has_shopping_list` (`unit_type_id` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `users`;

CREATE TABLE IF NOT EXISTS `users`
(
    `id`         INT          NOT NULL AUTO_INCREMENT,
    `username`   VARCHAR(45)  NOT NULL,
    `password`   VARCHAR(60)  NOT NULL,
    `email`      VARCHAR(100) NOT NULL,
    `created_at` TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `update_at`  TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB;

CREATE UNIQUE INDEX `email_UNIQUE` ON `users` (`email` ASC) VISIBLE;

CREATE UNIQUE INDEX `username_UNIQUE` ON `users` (`username` ASC) VISIBLE;


-- -----------------------------------------------------
-- Table `settings`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `settings`;

CREATE TABLE IF NOT EXISTS `settings`
(
    `id`          INT          NOT NULL AUTO_INCREMENT,
    `key_name`    VARCHAR(45)  NOT NULL,
    `value`       VARCHAR(255) NOT NULL,
    `description` TEXT         NULL,
    `created_at`  TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    `updated_at`  TIMESTAMP    NOT NULL DEFAULT CURRENT_TIMESTAMP,
    PRIMARY KEY (`id`)
)
    ENGINE = InnoDB;

CREATE UNIQUE INDEX `key_name_UNIQUE` ON `settings` (`key_name` ASC) VISIBLE;


SET SQL_MODE = @OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS = @OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS = @OLD_UNIQUE_CHECKS;
